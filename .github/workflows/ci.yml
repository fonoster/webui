name: CI

on:
  push:
    branches: [ master ]

  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment'
        required: true

jobs:

  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Install doctl
        uses: digitalocean/action-doctl@v2
        with:
          token: ${{ secrets.DIGITALOCEAN_ACCESS_TOKEN }}    
          script: |
            doctl compute ssh console
            cd /opt/fonoster
            # Stopping all containers
            docker-compose down
            # Removing all images
            docker system prune -fa
            # Restarting the service
            docker-compose up -d
